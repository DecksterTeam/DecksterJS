/*! deckster - v0.2.0 - 2015-03-10
* https://github.com/DecksterTeam/DecksterJS
* Copyright (c) 2015 Deckster Team; Licensed MIT */
!function(t){"use strict";"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(t){return-1!==this.indexOf(t,this.length-t.length)}),t.Hashcode=function(){var t=function(t){var e,n=0;for(t=t.toString(),e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e)&4294967295;return n},e=function(e){var o=0;for(var s in e)e.hasOwnProperty(s)&&(o+=t(s+n(e[s])));return o},n=function(n){var o={string:t,number:t,"boolean":t,object:e},s=typeof n;return null!==n&&o[s]?o[s](n)+t(s):0};return{value:n}}(),t._=t._||{};var e=function(t,e){return null!=t&&hasOwnProperty.call(t,e)},n=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},o=function(t){if(!n(t))return[];if(Object.keys)return Object.keys(t);var o=[];for(var s in t)e(t,s)&&o.push(s);return o},s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=function(t){var e=function(e){return t[e]},n="(?:"+o(t).join("|")+")",s=new RegExp(n),i=new RegExp(n,"g");return function(t){return t=null==t?"":""+t,s.test(t)?t.replace(i,e):t}};t._.escape=i(s)}(window),function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):t.DecksterCard=e(t.$||t.jQuery)}(this,function(t){"use strict";function e(e,o){this.$el=t(e),this.$deckster=this.$el.parent().data("deckster"),this.options=t.extend(!0,{},n,o),this.$cardHashKey=Hashcode.value(this.options),this.currentSection="summary",this.isExpanded=!1,this.$el.data("deckster-card",this)}var n={id:null,cardType:!1,title:null,icon:null,lazyLoad:!0,usePopoutLayout:!0,hasPopout:!1,expandable:!0,showFooter:!0,summaryContentHtml:null,summaryContentUrl:null,detailsContentHtml:null,detailsContentUrl:null,leftControlsHtml:null,leftControlsContentUrl:null,rightControlsHtml:null,rightControlsContentUrl:null,position:{size_x:1,size_y:1,expanded_x:null,expanded_y:null,col:1,row:1},onSummaryLoad:t.noop,onSummaryDisplayed:t.noop,onDetailsLoad:t.noop,onDetailsDisplayed:t.noop,onResize:t.noop,onExpand:t.noop,onCollapse:t.noop,loadData:t.noop};e.getDefaults=function(){return n},e.getCardHtml=function(e){var o=Deckster.Templates["card/card"];return o({card:t.extend(!0,{},n,e)})},e.getCardHash=function(e){return Hashcode.value(t.extend(!0,{},n,e))};var o=e.prototype;o.getCardData=function(){var e=this.$el.data("coords").grid,n={size_x:e.size_x,size_y:e.size_y,col:e.col,row:e.row};return t.extend(!0,{},this.options,{position:n})},o.loadCard=function(){return this.loadSummaryContent(),this.hasDetails=!(!this.options.detailsContentHtml&&!this.options.detailsContentUrl),!this.options.expandable||this.options.isPopout?this.$el.find(".deckster-card-toggle").hide():this.$el.find(".deckster-card-toggle").show(),!this.options.hasPopout||this.options.isPopout?this.$el.find(".deckster-card-popout").hide():this.$el.find(".deckster-card-popout").show(),!this.hasDetails||this.options.lazyLoad&&"details"!==this.currentSection||this.loadDetailsContent(),this.bindCardHandlers(),this},o.loadPopout=function(){return this.options.isPopout&&this.$el.html('<div class="deckster-popout-wrapper">'+e.getCardHtml(this.options)+"</div>"),this.loadCard()},o.setCardContent=function(t,e){var n=this.$el.find(".deckster-card-content .deckster-"+t);return n.empty(),n.html(e),this[t+"Loaded"]=!0,"summary"===t?this.options.onSummaryLoad(this):this.options.onDetailsLoad(this),this.loadLeftControls(),this.loadRightControls(),this};var s=function(e,n){t.get(e,n)};return o.loadLeftControls=function(){return t.isFunction(this.options.leftControlsHtml)?this.options.leftControlsHtml(this,t.proxy(function(t){this.$el.find(".deckster-card-controls.left").empty().html(t)},this)):this.options.leftControlsHtml?this.$el.find(".deckster-card-controls.left").empty().html(this.options.leftControlsHtml):this.options.leftControlsContentUrl&&s(this.options.leftControlsContentUrl,t.proxy(function(t){this.$el.find(".deckster-card-controls.left").empty().html(t)},this)),this},o.loadRightControls=function(){return t.isFunction(this.options.rightControlsHtml)?this.options.rightControlsHtml(this,t.proxy(function(t){this.$el.find(".deckster-card-controls.right").empty().html(t)},this)):this.options.rightControlsHtml?this.$el.find(".deckster-card-controls.right").empty().html(this.options.rightControlsHtml):this.options.rightControlsContentUrl&&s(this.options.rightControlsContentUrl,t.proxy(function(t){this.$el.find(".deckster-card-controls.right").empty().html(t)},this)),this},o.loadSummaryContent=function(){return t.isFunction(this.options.summaryContentHtml)?this.options.summaryContentHtml(this,t.proxy(function(t){this.setCardContent("summary",t)},this)):this.options.summaryContentHtml?this.setCardContent("summary",this.options.summaryContentHtml):this.options.summaryContentUrl&&s(this.options.summaryContentUrl,t.proxy(function(t){this.setCardContent("summary",t)},this)),this},o.loadDetailsContent=function(){return t.isFunction(this.options.detailsContentHtml)?this.options.detailsContentHtml(this,t.proxy(function(t){this.setCardContent("details",t)},this)):this.options.detailsContentHtml?this.setCardContent("details",this.options.detailsContentHtml):this.options.detailsContentUrl&&s(this.options.detailsContentUrl,t.proxy(function(t){this.setCardContent("details",t)},this)),this},o.loadContent=function(t){return"summary"===t?this.loadSummaryContent():this.loadDetailsContent(),this},o.reloadContent=function(){return this.loadCard()},o.expandCard=function(t){var e=this;this.$deckster.$gridster.expand_widget(this.$el,this.options.position.expanded_x,this.options.position.expanded_y||4,function(){e.isExpanded=!0,e.$el.find(".deckster-card-toggle").removeClass("glyphicon-resize-full").addClass("glyphicon-resize-small"),t?t.call(e):e.options.onExpand.call(e)})},o.collapseCard=function(t){var e=this;this.$deckster.$gridster.collapse_widget(this.$el,function(){e.isExpanded=!1,e.$el.find(".deckster-card-toggle").removeClass("glyphicon-resize-small").addClass("glyphicon-resize-full"),t?t.call(e):e.options.onCollapse.call(e)})},o.toggleCard=function(t){this.options.expandable&&(this.isExpanded?this.collapseCard(t):this.expandCard(t))},o.changeSection=function(e,n){return this.$el.find(".deckster-"+n).fadeOut(200,t.proxy(function(){this.$el.find(".deckster-"+this.currentSection).fadeIn(200)},this)),this},o.toggleSection=function(t){var e=this.currentSection;return this.currentSection=t?t:"summary"===this.currentSection&&this.hasDetails?"details":"summary",this.currentSection!==e?(this.loadContent(this.currentSection),this.options.expandable?this.toggleCard(function(){this.changeSection(this.currentSection,e)}):this.changeSection(this.currentSection,e)):this.options.expandable&&this.toggleCard(),this},o.bindCardHandlers=function(){return this.$el.off("click.deckster-card",".deckster-card-toggle"),this.$el.on("click.deckster-card",".deckster-card-toggle",t.proxy(function(){this.toggleSection()},this)),this.$el.off("click.deckster-card",".deckster-card-reload"),this.$el.on("click.deckster-card",".deckster-card-reload",t.proxy(function(){this.reloadContent()},this)),this.$el.off("click.deckster-card",".deckster-card-remove"),this.$el.on("click.deckster-card",".deckster-card-remove",t.proxy(function(){this.destroy()},this)),this},o.destroy=function(){this.$el.off("click.deckster-card",".deckster-card-toggle"),this.$el.off("click.deckster-card",".deckster-card-reload"),this.$el.off("click.deckster-card",".deckster-card-remove"),this.$deckster.removeCard(this)},e}),function(){window.Deckster=window.Deckster||{},window.Deckster.Templates=window.Deckster.Templates||{},window.Deckster.Templates["card/card"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+=card.isPopout?'\n<div class="deckster-card is-popout" id="'+(null==(__t=card.id)?"":__t)+'">\n':'\n<div class="deckster-card" id="'+(null==(__t=card.id)?"":__t)+'">\n',__p+='\n    <div class="deckster-card-inner">\n        <div class="deckster-card-header">\n            <div class="card-icon"><i class="'+(null==(__t=card.icon)?"":__t)+'"></i></div>\n            <div class="deckster-card-controls left"></div>\n            <div class="deckster-card-title drag-handle">'+(null==(__t=card.title)?"":__t)+'</div>\n            <div class="deckster-default-controls">\n              <span class="deckster-card-control deckster-card-reload glyphicon glyphicon-refresh"></span>\n              <span class="deckster-card-control deckster-card-toggle glyphicon glyphicon-resize-full"></span>\n              <a href="'+(null==(__t=card.rootUrl)?"":__t)+"/card/"+(null==(__t=card.id)?"":__t)+'" target="_blank" class="deckster-card-control deckster-card-popout glyphicon glyphicon-new-window thin"></a>\n            </div>\n            <div class="deckster-card-controls right"></div>\n        </div>\n        <div class="deckster-card-content">\n            <div class="deckster-card-loading"></div>\n            <div class="deckster-summary"></div>\n            <div class="deckster-details" style="display: none;"></div>\n        </div>\n        ',card.showFooter&&(__p+='\n        <div class="deckster-card-footer">\n          <div class="left-controls"></div>\n          <div class="right-controls">\n            <span class="deckster-card-control deckster-card-remove glyphicon glyphicon-trash"></span>\n          </div>\n        </div>\n        '),__p+="\n    </div>\n</div>\n";return __p}}(),function(){window.Deckster=window.Deckster||{},window.Deckster.Templates=window.Deckster.Templates||{},window.Deckster.Templates["deck/dock"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="deckster-deck-dock">\n</div>';return __p}}(),function(){window.Deckster=window.Deckster||{},window.Deckster.Templates=window.Deckster.Templates||{},window.Deckster.Templates["deck/toolbar"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div class="deckster-deck-toolbar">\n    <img class="deck-toolbar-logo" src="'+(null==(__t=deck.logoUrl)?"":__t)+'"/>\n    <div class="deck-search-wrapper">\n        <input type="text" class="deck-toolbar-searchbox" placeholder="'+(null==(__t=deck.searchPlaceholder)?"":__t)+'">\n    </div>\n    <div class="deck-toolbar-controls">\n        <span class="toolbar-control refresh glyphicon glyphicon-refresh"></span>\n        <span class="toolbar-control settings glyphicon glyphicon-cog"></span>\n        <span class="toolbar-control save glyphicon glyphicon-floppy-disk"></span>\n    </div>\n</div>';return __p}}();