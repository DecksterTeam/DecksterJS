/*! deckster - v0.1.0 - 2015-02-24
* https://github.com/DecksterTeam/DecksterJS
* Copyright (c) 2015 Deckster Team; Licensed MIT */
(function(t){"use strict";"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(t){return-1!==this.indexOf(t,this.length-t.length)}),t.Hashcode=function(){var t=function(t){var e,n=0;for(t=""+t,e=0;t.length>e;e++)n=4294967295&(n<<5)-n+t.charCodeAt(e);return n},e=function(e){var s=0;for(var i in e)e.hasOwnProperty(i)&&(s+=t(i+n(e[i])));return s},n=function(n){var s={string:t,number:t,"boolean":t,object:e},i=typeof n;return null!==n&&s[i]?s[i](n)+t(i):0};return{value:n}}(),t._=t._||{};var e=function(t,e){return null!=t&&hasOwnProperty.call(t,e)},n=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},s=function(t){if(!n(t))return[];if(Object.keys)return Object.keys(t);var s=[];for(var i in t)e(t,i)&&s.push(i);return s},i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},o=function(t){var e=function(e){return t[e]},n="(?:"+s(t).join("|")+")",i=RegExp(n),o=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(o,e):t}};t._.escape=o(i)})(window),function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):t.DecksterCard=e(t.$||t.jQuery)}(this,function(t){"use strict";function e(e,s){this.$el=t(e),this.$deckster=this.$el.parent().data("deckster"),this.options=t.extend(!0,{},n,s),this.$cardHashKey=Hashcode.value(this.options),this.currentSection="summary"}var n={id:null,title:null,icon:null,lazyLoad:!0,usePopoutLayout:!0,hasPopout:!1,summaryContentHtml:null,summaryContentUrl:null,detailsContentHtml:null,detailsContentUrl:null,position:{size_x:1,size_y:1,expanded_x:null,expanded_y:null,col:1,row:1},onSummaryLoad:t.noop,onDetailsLoad:t.noop,loadData:t.noop};e.getDefaults=function(){return n},e.getCardHtml=function(t){var e=Deckster.Templates["card/card"];return e({card:t})},e.getCardHash=function(t){return Hashcode.value(t)};var s=e.prototype;s.getCardData=function(){var e={size_x:this.$el.data("sizex"),size_y:this.$el.data("sizey"),col:this.$el.data("col"),row:this.$el.data("row")};return t.extend(!0,{},this.options,{position:e})},s.loadCard=function(){return this.loadSummaryContent(),this.hasDetails=this.options.detailsContentHtml||this.options.detailsContentUrl,!this.hasDetails||this.options.isPopout?this.$el.find(".deckster-card-toggle").hide():this.$el.find(".deckster-card-toggle").show(),!this.options.hasPopout||this.options.isPopout?this.$el.find(".deckster-card-popout").hide():this.$el.find(".deckster-card-popout").show(),!this.hasDetails||this.options.lazyLoad&&"details"!==this.currentSection||this.loadDetailsContent(),this.bindCardHandlers(),this},s.loadPopout=function(){return this.options.isPopout&&this.$el.html('<div class="deckster-popout-wrapper">'+e.getCardHtml(this.options)+"</div>"),this.loadCard()},s.setCardContent=function(t,e){var n=this.$el.find(".deckster-card-content .deckster-"+t);return n.empty(),n.html(e),this[t+"Loaded"]=!0,"summary"===t?this.options.onSummaryLoad(this):this.options.onDetailsLoad(this),this};var i=function(e,n){t.get(e,n)};return s.loadSummaryContent=function(){t.isFunction(this.options.summaryContentHtml)?this.options.summaryContentHtml(this.options,t.proxy(function(t){this.setCardContent("summary",t)},this)):this.options.summaryContentHtml?this.setCardContent("summary",this.options.summaryContentHtml):this.options.summaryContentUrl&&i(this.options.summaryContentUrl,t.proxy(function(t){this.setCardContent("summary",t)},this))},s.loadDetailsContent=function(){t.isFunction(this.options.detailsContentHtml)?this.options.detailsContentHtml(this.options,t.proxy(function(t){this.setCardContent("details",t)},this)):this.options.detailsContentHtml?this.setCardContent("details",this.options.detailsContentHtml):this.options.detailsContentUrl&&i(this.options.detailsContentUrl,t.proxy(function(t){this.setCardContent("details",t)},this))},s.loadContent=function(t){"summary"===t?this.loadSummaryContent():this.loadDetailsContent()},s.reloadContent=function(){this.loadCard()},s.toggleSection=function(e){this.currentSection=e?e:"summary"===this.currentSection?"details":"summary",this.loadContent(this.currentSection);var n="summary"===this.currentSection?"details":"summary";return this.$el.find(".deckster-"+n).fadeOut(200,t.proxy(function(){if(!this.options.isPopout){var t=this.options.position.expanded_x,e=this.options.position.expanded_y||4;"summary"===n?this.$deckster.$gridster.expand_widget(this.$el,t,e):this.$deckster.$gridster.collapse_widget(this.$el);var s="summary"===this.currentSection?"glyphicon-resize-full":"glyphicon-resize-small";this.$el.find(".deckster-card-toggle").removeClass("glyphicon-resize-small glyphicon-resize-full").addClass(s)}this.$el.find(".deckster-"+this.currentSection).fadeIn(200)},this)),this},s.bindCardHandlers=function(){return this.$el.off("click.deckster-card",".deckster-card-toggle"),this.$el.on("click.deckster-card",".deckster-card-toggle",t.proxy(function(){this.toggleSection()},this)),this.$el.off("click.deckster-card",".deckster-card-reload"),this.$el.on("click.deckster-card",".deckster-card-reload",t.proxy(function(){this.reloadContent()},this)),this},e}),function(t,e){"function"==typeof define&&define.amd?define(["jquery","deckster-card","gridster"],e):t.Deckster=e(t.$||t.jQuery,t.DecksterCard,t.Gridster)}(this,function(t,e,n){"use strict";function s(e,n){this.$el=t(e),this.$cardHash={},this.$gridster=null,this.options=t.extend(!0,{},i,n),this.options.autoInit&&this.init()}var i={showDock:!1,showToolbar:!1,rootUrl:"/deckster",autoInit:!0,gridsterOpts:{columns:5,margins:[10,10],rowHeight:150,draggable:{handle:".drag-handle"},resize:{enabled:!0}}};s.getRoutes=function(t,e){return t=t?t:"deckster/",t=t&&t.endsWith("/")?t:t+"/",e=e?e:"?",[{basePath:t+"card",fullPath:t+"card/:id/:section"+e,queryParams:[{name:"id",optional:!1},{name:"section",optional:!0}]}]},s.getPopoutRoute=function(t,e){return t=t?t:"deckster/",t=t&&t.endsWith("/")?t:t+"/",e=e?e:"?",{basePath:t+"card",fullPath:t+"card/:id/:section"+e,queryParams:[{name:"id",optional:!1},{name:"section",optional:!0}]}},s.generatePopout=function(t,n,s){return n.isPopout=!0,s=s||"details",new e(t,n).loadPopout().toggleSection(s)};var o=s.prototype;return o.init=function(t){this.$gridster=new n(this.$el,this.options.gridsterOpts),t&&this.addCards(t)},o.hasCard=function(t){var n=e.getCardHash(t);return this.$cardHash.hasOwnProperty(n)},o.getCards=function(){return t.map(this.$cardHash,function(t){return t})},o.addCards=function(e){return t.each(e,t.proxy(function(t,e){this.hasCard(e)||this.addCard(e)},this)),this},o.addCard=function(t){t.rootUrl=t.rootUrl||this.options.rootUrl;var n=this.$gridster.add_widget(e.getCardHtml(t),t.position?t.position.size_x:null,t.position?t.position.size_y:null,t.position?t.position.col:null,t.position?t.position.row:null),s=new e(n,t).loadCard();return this.$cardHash[s.$cardHashKey]=s,s},o.destroy=function(){this.$gridster.destroy()},t.fn.deckster=function(e){return this.each(function(){t.data(this,"deckster")||t.data(this,"deckster",new s(this,e))})},s}),this.Deckster=this.Deckster||{},this.Deckster.Templates=this.Deckster.Templates||{},this.Deckster.Templates["card/card"]=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj)__p+=card.isPopout?'\n<div class="deckster-card is-popout" id="'+(null==(__t=card.id)?"":__t)+'">\n':'\n<div class="deckster-card" id="'+(null==(__t=card.id)?"":__t)+'">\n',__p+='\n    <div class="deckster-card-inner">\n        <div class="deckster-card-header">\n            <div class="card-icon"><i class="'+(null==(__t=card.icon)?"":__t)+'"></i></div>\n            <div class="deckster-card-functions">\n                <span class="deckster-card-function deckster-card-menu glyphicon glyphicon-menu-hamburger"></span>\n            </div>\n            <div class="deckster-card-controls">\n                <span class="deckster-card-control deckster-card-reload glyphicon glyphicon-refresh"></span>\n                <span class="deckster-card-control deckster-card-toggle glyphicon glyphicon-resize-full"></span>\n                <a href="'+(null==(__t=card.rootUrl)?"":__t)+"/card/"+(null==(__t=card.id)?"":__t)+'" target="_blank" class="deckster-card-control deckster-card-popout glyphicon glyphicon-new-window thin"></a>\n            </div>\n            <div class="deckster-card-title drag-handle">'+(null==(__t=card.title)?"":__t)+'</div>\n        </div>\n        <div class="deckster-card-content">\n            <div class="deckster-card-loading"></div>\n            <div class="deckster-summary"></div>\n            <div class="deckster-details" style="display: none;"></div>\n        </div>\n    </div>\n</div>';return __p};