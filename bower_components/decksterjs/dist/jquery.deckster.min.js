/*! deckster - v0.0.0 - 2015-02-23
* https://github.com/DecksterTeam/DecksterJS
* Copyright (c) 2015 Deckster Team; Licensed MIT */
(function(t){"use strict";"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(t){return-1!==this.indexOf(t,this.length-t.length)}),t.Hashcode=function(){var t=function(t){var n,e=0;for(t=""+t,n=0;t.length>n;n++)e=4294967295&(e<<5)-e+t.charCodeAt(n);return e},n=function(n){var i=0;for(var s in n)n.hasOwnProperty(s)&&(i+=t(s+e(n[s])));return i},e=function(e){var i={string:t,number:t,"boolean":t,object:n},s=typeof e;return null!==e&&i[s]?i[s](e)+t(s):0};return{value:e}}(),t._=t._||{};var n=function(t,n){return null!=t&&hasOwnProperty.call(t,n)},e=function(t){var n=typeof t;return"function"===n||"object"===n&&!!t},i=function(t){if(!e(t))return[];if(Object.keys)return Object.keys(t);var i=[];for(var s in t)n(t,s)&&i.push(s);return i},s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},o=function(t){var n=function(n){return t[n]},e="(?:"+i(t).join("|")+")",s=RegExp(e),o=RegExp(e,"g");return function(t){return t=null==t?"":""+t,s.test(t)?t.replace(o,n):t}};t._.escape=o(s)})(window),function(t,n){"function"==typeof define&&define.amd?define(["jquery"],n):t.DecksterCard=n(t.$||t.jQuery)}(this,function(t){"use strict";function n(n,i){this.$el=t(n),this.$deckster=this.$el.parent().data("deckster"),this.options=t.extend(!0,{},e,i),this.$cardHashKey=Hashcode.value(this.options),this.currentSection="summary"}var e={id:null,title:null,icon:null,lazyLoad:!0,usePopoutLayout:!0,hasPopout:!1,summaryContentHtml:null,summaryContentUrl:null,detailsContentHtml:null,detailsContentUrl:null,position:{size_x:1,size_y:1,expanded_x:null,expanded_y:null,col:1,row:1},onSummaryLoad:t.noop,onDetailsLoad:t.noop,loadData:t.noop};n.getDefaults=function(){return e},n.getCardHtml=function(t){var n=Deckster.Templates["card/card"];return n({card:t})},n.getCardHash=function(t){return Hashcode.value(t)};var i=n.prototype;i.getCardData=function(){var n={size_x:this.$el.data("sizex"),size_y:this.$el.data("sizey"),col:this.$el.data("col"),row:this.$el.data("row")};return t.extend(!0,{},this.options,{position:n})},i.loadCard=function(){return this.loadSummaryContent(),this.hasDetails=this.options.detailsContentHtml||this.options.detailsContentUrl,this.hasDetails?this.$el.find(".deckster-card-toggle").show():this.$el.find(".deckster-card-toggle").hide(),this.options.hasPopout?this.$el.find(".deckster-card-popout").show():this.$el.find(".deckster-card-popout").hide(),!this.hasDetails||this.options.lazyLoad&&"details"!==this.currentSection||this.loadDetailsContent(),this.bindCardHandlers(),this},i.setCardContent=function(t,n){var e=this.$el.find(".deckster-card-content .deckster-"+t);return e.empty(),e.html(n),this[t+"Loaded"]=!0,"summary"===t?this.options.onSummaryLoad(this):this.options.onDetailsLoad(this),this};var s=function(n,e){t.get(n,e)};return i.loadSummaryContent=function(){t.isFunction(this.options.summaryContentHtml)?this.options.summaryContentHtml(t.proxy(function(t){this.setCardContent("summary",t)},this)):this.options.summaryContentHtml?this.setCardContent("summary",this.options.summaryContentHtml):this.options.summaryContentUrl&&s(this.options.summaryContentUrl,t.proxy(function(t){this.setCardContent("summary",t)},this))},i.loadDetailsContent=function(){t.isFunction(this.options.detailsContentHtml)?this.options.detailsContentHtml(t.proxy(function(t){this.setCardContent("details",t)},this)):this.options.detailsContentHtml?this.setCardContent("details",this.options.detailsContentHtml):this.options.detailsContentUrl&&s(this.options.detailsContentUrl,t.proxy(function(t){this.setCardContent("details",t)},this))},i.loadContent=function(t){"summary"===t?this.loadSummaryContent():this.loadDetailsContent()},i.reloadContent=function(){this.loadCard()},i.toggleSection=function(n){this.currentSection=n?n:"summary"===this.currentSection?"details":"summary",this.loadContent(this.currentSection);var e="summary"===this.currentSection?"details":"summary";return this.$el.find(".deckster-"+e).fadeOut(200,t.proxy(function(){var t=this.options.position.expanded_x,n=this.options.position.expanded_y||4;"summary"===e?this.$deckster.$gridster.expand_widget(this.$el,t,n):this.$deckster.$gridster.collapse_widget(this.$el);var i="summary"===this.currentSection?"glyphicon-resize-full":"glyphicon-resize-small";this.$el.find(".deckster-card-toggle").removeClass("glyphicon-resize-small glyphicon-resize-full").addClass(i),this.$el.find(".deckster-"+this.currentSection).fadeIn(200)},this)),this},i.bindCardHandlers=function(){return this.$el.off("click.deckster-card",".deckster-card-toggle"),this.$el.on("click.deckster-card",".deckster-card-toggle",t.proxy(function(){this.toggleSection()},this)),this.$el.off("click.deckster-card",".deckster-card-reload"),this.$el.on("click.deckster-card",".deckster-card-reload",t.proxy(function(){this.reloadContent()},this)),this},n}),function(t,n){"function"==typeof define&&define.amd?define(["jquery","deckster-card","gridster"],n):t.Deckster=n(t.$||t.jQuery,t.DecksterCard,t.Gridster)}(this,function(t,n,e){"use strict";function i(n,e){this.$el=t(n),this.$cardHash={},this.$gridster=null,this.options=t.extend(!0,{},s,e),this.options.autoInit&&this.init()}var s={showDock:!1,showToolbar:!1,autoInit:!0,gridsterOpts:{columns:5,margins:[10,10],rowHeight:150,draggable:{handle:".drag-handle"},resize:{enabled:!0}}};i.getRoutes=function(t,n){return t=t?t:"deckster/",t=t&&t.endsWith("/")?t:t+"/",n=n?n:"?",[{basePath:t+"card",fullPath:t+"card/:id/:section"+n,queryParams:[{name:"id",optional:!1},{name:"section",optional:!0}]}]},i.generatePopout=function(t,e,i){e.isPopout=!0,i=i||"details";var s=new n(t,e);s.toggleSection(i)};var o=i.prototype;return o.init=function(t){this.$gridster=new e(this.$el,this.options.gridsterOpts),t&&this.addCards(t)},o.hasCard=function(t){var e=n.getCardHash(t);return this.$cardHash.hasOwnProperty(e)},o.getCards=function(){return t.map(this.$cardHash,function(t){return t})},o.addCards=function(n){return t.each(n,t.proxy(function(t,n){this.hasCard(n)||this.addCard(n)},this)),this},o.addCard=function(t){var e=this.$gridster.add_widget(n.getCardHtml(t),t.position?t.position.size_x:null,t.position?t.position.size_y:null,t.position?t.position.col:null,t.position?t.position.row:null),i=new n(e,t).loadCard();return this.$cardHash[i.$cardHashKey]=i,i},o.destroy=function(){this.$gridster.destroy()},t.fn.deckster=function(n){return this.each(function(){t.data(this,"deckster")||t.data(this,"deckster",new i(this,n))})},i});